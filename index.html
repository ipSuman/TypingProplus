<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Typing Pro+</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg:#0f131a;
  --card:#171f2b;
  --text:#ffffff;
  --sub:#7fbfc0;
  --accent:#2fb9b3;
  --box-bg: #0b1016; 
  --box-text: #ffffff;
  --correct:#7CFF9B;
  --half:#FFE066;
  --wrong:#FF7C7C;
  --brown:#8b5a2b;
  --orange:#ff9f43;
  --purple:#8e44ad;
  --red-black:#360a0a;
  --shadow:rgba(0,0,0,0.6);
  --timer-red: #ff4757; 
}

.light {
  --bg:#eef7f7;
  --card:#ffffff;
  --text:#111111;
  --sub:#4a6f70;
  --accent:#2fb9b3;
  --box-bg: #e3eaeb; 
  --box-text: #111111;
  --shadow:rgba(0,0,0,0.15);
}

* { box-sizing:border-box; font-family:system-ui,Segoe UI,sans-serif; }

body {
  margin:0;
  min-height:100vh;
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
  color:var(--text);
  transition: background 0.3s, color 0.3s;
}

.container {
  width:98%;
  max-width:1000px;
  background:var(--card);
  padding:25px;
  border-radius:28px;
  box-shadow:0 30px 60px var(--shadow);
}

.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom: 15px;
}

.title { font-size:1.8em; font-weight:700; color:var(--accent); }

.row {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:12px;
  align-items: center; 
}

.switch-container {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.85em;
  color: var(--sub);
  font-weight: 600;
}

.switch {
  position:relative;
  width:44px;
  height:22px;
}
.switch input { opacity:0; width:0; height:0; }
.slider {
  position:absolute;
  inset:0;
  background:#555;
  transition:.3s;
  border-radius:999px;
  cursor: pointer;
}
.slider:before {
  content:"";
  position:absolute;
  height:16px;
  width:16px;
  left:3px;
  bottom:3px;
  background:white;
  transition:.3s;
  border-radius:50%;
}
input:checked + .slider { background:var(--accent); }
input:checked + .slider:before { transform:translateX(22px); }

button, select, input, textarea {
  border:none;
  border-radius:14px;
  padding:10px 14px;
  background: var(--box-bg);
  color: var(--box-text);
  outline:none;
}

.btn-pill {
  font-size: 0.8em;
  padding: 8px 14px;
  font-weight: 600;
  cursor: pointer;
}

.btn-brown { background:var(--brown); color:white;}
.btn-purple { background:var(--purple); color:white;}
.btn-redblack { background:var(--red-black); color:#ffcccc; padding: 6px 14px; }

#customText {
  width:100%;
  resize:none;
  height:65px;
  margin-bottom: 15px;
}

#time {
  font-size: 4rem;
  font-weight: 800;
  color: var(--timer-red);
  text-align: center;
  margin: 10px 0;
  line-height: 1;
}

.text-box {
  background: var(--box-bg); 
  border-radius:22px;
  padding:20px;
  height: 8.5em; 
  overflow-y:auto;
  line-height:1.7;
  font-size:1.15em;
  margin-bottom: 15px;
}

.text-box span.correct { color:var(--correct); }
.text-box span.half { color:var(--half); }
.text-box span.wrong { color:var(--wrong); }

/* Legibility Fix for Light Mode */
.light .text-box span.correct { color:#1b5e20; font-weight: 600; }
.light .text-box span.half { color:#917100; }
.light .text-box span.wrong { color:#b71c1c; }

.input {
  width:100%;
  padding:20px;
  border-radius:20px;
  height: 8.5em; 
  font-size: 1.1em;
  margin-bottom: 20px;
  resize: none;
}

.stats {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(130px,1fr));
  gap:12px;
}
.stat {
  background: var(--box-bg); 
  border-radius:20px;
  padding:15px;
  text-align:center;
}
.stat h3 { margin:0; font-size:.75em; color:var(--sub); text-transform: uppercase; }
.stat p { margin:6px 0 0; font-size:1.5em; font-weight:bold; }

.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.modal-content {
  background:var(--card);
  padding:25px;
  border-radius:24px;
  width:90%;
  max-width:700px;
}

.bksp-icon { font-size: 1.3em; color: var(--sub); }
</style>
</head>

<body>
<div class="container">

  <div class="header">
    <div class="title">Typing Pro+</div>
    <div style="display: flex; gap: 10px; align-items: center;">
      <button class="btn-redblack" onclick="openHistory()">History</button>
      <div class="switch-container">
        <span>‚òÄÔ∏è/üåô</span>
        <label class="switch">
          <input type="checkbox" onchange="toggleTheme()">
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </div>

  <div class="row">
    <input id="username" placeholder="Enter your name" style="flex: 1;">
    <select id="timeMode" onchange="resetTestState()">
      <option value="60">1 Minute</option>
      <option value="120">2 Minutes</option>
      <option value="180">3 Minutes</option>
      <option value="300">5 Minutes</option>
      <option value="600">10 Minutes</option>
    </select>
  </div>

  <div class="row">
    <div class="switch-container">
        <span>Endless</span>
        <label class="switch">
            <input type="checkbox" id="endlessToggle" onchange="resetTestState()">
            <span class="slider"></span>
        </label>
    </div>
    <div class="switch-container">
        <span>Auto-Submit</span>
        <label class="switch">
            <input type="checkbox" id="autoSubmitToggle" checked>
            <span class="slider"></span>
        </label>
    </div>
    <div class="switch-container" style="margin-left: auto;">
        <span class="bksp-icon">‚å´</span>
        <label class="switch">
            <input type="checkbox" checked onchange="toggleBackspace(this)">
            <span class="slider"></span>
        </label>
    </div>
  </div>

  <textarea id="customText" oninput="resetTestState()" placeholder="Paste or type your custom typing text here..."></textarea>

  <div class="row">
    <button class="btn-pill btn-brown" onclick="saveFavorite()">Save Favorite</button>
    <select id="selectionMenu" class="btn-pill btn-purple" onchange="handleSelectionChange()">
      <option value="">Select text</option>
      <option value="random">üé≤ Random Text</option>
      <option value="quotes">üìú Famous Quotes</option>
      <optgroup label="Favorites" id="favGroup"></optgroup>
    </select>
  </div>

  <div id="time">01:00</div>

  <div id="text" class="text-box"></div>
  <textarea id="input" class="input" placeholder="Start typing to begin..." onfocus="checkInit()"></textarea>

  <div class="stats">
    <div class="stat"><h3>WPM</h3><p id="wpm">0</p></div>
    <div class="stat"><h3>Net Speed</h3><p id="net">0</p></div>
    <div class="stat"><h3>Accuracy</h3><p id="acc">100%</p></div>
    <div class="stat"><h3>Error Rate</h3><p id="errRate">0</p></div>
    <div class="stat"><h3>Backspaces</h3><p id="backCount">0</p></div>
    <div class="stat"><h3>Wrong</h3><p id="wrongCount">0</p></div>
  </div>

</div>

<div class="modal" id="historyModal">
  <div class="modal-content">
    <h2>History</h2>
    <div id="historyTable" style="max-height: 300px; overflow-y: auto;"></div>
    <br>
    <button class="btn-pill btn-brown" onclick="clearHistory()">Clear</button>
    <button class="btn-pill btn-purple" onclick="closeHistory()">Close</button>
  </div>
</div>

<script>
const randomTexts = [
    "Innovation is the ability to see change as an opportunity, not a threat. The only way to do great work is to love what you do every day.",
    "The keyboard is mightier than the sword when used with precision and intent. Speed comes with practice, but accuracy comes with focus.",
    "Data science is about using data to answer questions and solve problems. It requires a mix of coding, statistics, and domain knowledge.",
    "Design is not just what it looks like and feels like. Design is how it works and how it solves a problem for the user effectively.",
    "Every line of code you write is a step toward building something greater. Keep typing, keep learning, and keep creating something new."
];

const famousQuotes = [
  "To be, or not to be, that is the question.", "I'm going to make him an offer he can't refuse.", "May the Force be with you.", "Frankly, my dear, I don't give a damn.", "Here's looking at you, kid.", "The only thing we have to fear is fear itself.", "It was the best of times, it was the worst of times.", "Ask not what your country can do for you; ask what you can do for your country.", "I have a dream that one day this nation will rise up.", "Elementary, my dear Watson.", "E.T. phone home.", "Bond. James Bond.", "There's no place like home.", "Show me the money!", "Keep your friends close, but your enemies closer.", "I'll be back.", "You're gonna need a bigger boat.", "Houston, we have a problem.", "I think this is the beginning of a beautiful friendship.", "Winter is coming.", "The winter of our discontent.", "All that glitters is not gold.", "Parting is such sweet sorrow.", "The fault, dear Brutus, is not in our stars.", "Life is what happens when you're busy making other plans.", "You talking to me?", "Say hello to my little friend!", "Toto, I've a feeling we're not in Kansas anymore.", "The greatest glory in living lies not in never falling, but in rising every time we fall.", "In the end, it's not the years in your life that count. It's the life in your years.", "Spread love everywhere you go.", "Always remember that you are absolutely unique. Just like everyone else.", "The future belongs to those who believe in the beauty of their dreams.", "Tell me and I forget. Teach me and I remember. Involve me and I learn.", "The best and most beautiful things in the world cannot be seen or even touched - they must be felt with the heart.", "It is during our darkest moments that we must focus to see the light.", "Whoever is happy will make others happy too.", "Do not go where the path may lead, go instead where there is no path and leave a trail.", "Be yourself; everyone else is already taken.", "In three words I can sum up everything I've learned about life: it goes on.", "No one can make you feel inferior without your consent.", "Live as if you were to die tomorrow. Learn as if you were to live forever.", "I've learned that people will forget what you said, people will forget what you did, but people will never forget how you made them feel.", "If you set your goals ridiculously high and it's a failure, you will fail above everyone else's success.", "Whether you think you can or you think you can't, you're right.", "Success is not final, failure is not fatal: it is the courage to continue that counts.", "Believe you can and you're halfway there.", "The only way to do great work is to love what you do.", "The way to get started is to quit talking and begin doing.", "Your time is limited, so don't waste it living someone else's life.", "I am the master of my fate, I am the captain of my soul.", "The unexamined life is not worth living.", "Work hard in silence, let your success be your noise.", "Dream big and dare to fail.", "Everything you've ever wanted is on the other side of fear.", "Don't count the days, make the days count.", "Success usually comes to those who are too busy to be looking for it.", "Opportunities don't happen. You create them.", "Don't be afraid to give up the good to go for the great.", "I find that the harder I work, the more luck I seem to have.", "Success is walking from failure to failure with no loss of enthusiasm.", "The road to success and the road to failure are almost exactly the same.", "Stop chasing the money and start chasing the passion.", "I never dreamed about success, I worked for it.", "Great things never came from comfort zones.", "Do something today that your future self will thank you for.", "Little things make big days.", "It's going to be hard, but hard does not mean impossible.", "Don't stop when you're tired. Stop when you're done.", "Wake up with determination. Go to bed with satisfaction.", "The only person you should try to be better than is the person you were yesterday.", "Great things are done by a series of small things brought together.", "Nothing is impossible, the word itself says 'I'm possible'!", "You are never too old to set another goal or to dream a new dream.", "Everything has beauty, but not everyone sees it.", "Happiness is not something readymade. It comes from your own actions.", "The best way to predict your future is to create it.", "If you want to lift yourself up, lift up someone else.", "You miss 100% of the shots you don't take.", "A person who never made a mistake never tried anything new.", "Knowledge is power.", "The pen is mightier than the sword.", "Better late than never.", "Birds of a feather flock together.", "A picture is worth a thousand words.", "Absence makes the heart grow fonder.", "All good things must come to an end.", "Beauty is in the eye of the beholder.", "Cleanliness is next to godliness.", "Don't bite the hand that feeds you.", "Don't count your chickens before they hatch.", "Don't judge a book by its cover.", "Easy come, easy go.", "God helps those who help themselves.", "Good things come to those who wait.", "Honesty is the best policy.", "If you can't beat them, join them.", "Practice makes perfect.", "The early bird catches the worm.", "Time heals all wounds."
];

let textDisplay = document.getElementById("text");
let input = document.getElementById("input");
let timeDisplay = document.getElementById("time");
let wpmDisplay = document.getElementById("wpm");
let netDisplay = document.getElementById("net");
let accDisplay = document.getElementById("acc");
let errRateDisplay = document.getElementById("errRate");
let backDisplay = document.getElementById("backCount");
let wrongDisplay = document.getElementById("wrongCount");

let timer, initialTime, currentTime, isRunning = false;
let backspaceOn = true, backspaces = 0;

const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
const savedResults = JSON.parse(localStorage.getItem("results") || "[]");

function handleSelectionChange() {
    const val = document.getElementById("selectionMenu").value;
    if (val === "random") {
        document.getElementById("customText").value = randomTexts[Math.floor(Math.random() * randomTexts.length)];
    } else if (val === "quotes") {
        let selected = [];
        let tempArr = [...famousQuotes];
        for(let i=0; i<4; i++) {
            let idx = Math.floor(Math.random() * tempArr.length);
            selected.push(tempArr.splice(idx, 1)[0]);
        }
        document.getElementById("customText").value = selected.join(" ");
    } else if (val !== "") {
        document.getElementById("customText").value = favorites[val];
    }
    resetTestState();
}

function loadSelectionMenu() {
  const group = document.getElementById("favGroup");
  group.innerHTML = '';
  favorites.forEach((t, i) => {
    const o = document.createElement("option");
    o.value = i; o.textContent = "Favorite " + (i + 1);
    group.appendChild(o);
  });
}
loadSelectionMenu();

function saveFavorite() {
  const txt = document.getElementById("customText").value.trim();
  if(!txt) return;
  favorites.push(txt);
  localStorage.setItem("favorites", JSON.stringify(favorites));
  loadSelectionMenu();
}

function loadText(text) {
  textDisplay.innerHTML="";
  let finalString = document.getElementById("endlessToggle").checked ? (text + " ").repeat(10).trim() : text;
  finalString.split(" ").forEach(word => {
    const span = document.createElement("span");
    span.textContent = word + " ";
    textDisplay.appendChild(span);
  });
}

function resetTestState() {
  clearInterval(timer);
  isRunning = false;
  initialTime = parseInt(document.getElementById("timeMode").value);
  currentTime = initialTime;
  timeDisplay.innerText = `${Math.floor(currentTime/60).toString().padStart(2,'0')}:${(currentTime%60).toString().padStart(2,'0')}`;
  input.value=""; input.disabled=false;
  backspaces = 0;
  wpmDisplay.innerText="0"; netDisplay.innerText="0"; accDisplay.innerText="100%";
  errRateDisplay.innerText="0"; backDisplay.innerText="0"; wrongDisplay.innerText="0";
  const custom = document.getElementById("customText").value.trim();
  if(custom) loadText(custom);
  else textDisplay.innerHTML = "Please enter or select text above to start.";
}

resetTestState();

function checkInit() {
    const custom = document.getElementById("customText").value.trim();
    if(custom && textDisplay.innerHTML.includes("Please enter")) loadText(custom);
}

input.addEventListener("keydown", e => {
  if(e.key === "Backspace") {
    if(!backspaceOn) e.preventDefault();
    else { backspaces++; backDisplay.innerText = backspaces; }
  }
});

input.addEventListener("input", () => {
  if (!isRunning && input.value.length > 0) startTimer();
  handleTyping();
});

function startTimer() {
  isRunning = true;
  timer = setInterval(() => {
    if(currentTime > 0) {
      currentTime--;
      timeDisplay.innerText = `${Math.floor(currentTime/60).toString().padStart(2,'0')}:${(currentTime%60).toString().padStart(2,'0')}`;
      handleTyping();
    } else finishTest();
  }, 1000);
}

function handleTyping() {
  const typedWords = input.value.trim().split(/\s+/);
  const spans = [...textDisplay.querySelectorAll("span")];
  if(input.value.length === 0) return;

  let correctChars = 0, wrong = 0, half = 0, finished = false;

  spans.forEach((span, i) => {
    span.className = "";
    const real = span.textContent.trim();
    const typed = typedWords[i];
    if(!typed) return;

    if(typed === real) {
      span.className = "correct";
      correctChars += real.length;
      if(i === spans.length - 1) finished = true;
    } else if(real.startsWith(typed)) { span.className = "half"; half++; }
    else { span.className = "wrong"; wrong++; }
  });

  wrongDisplay.innerText = wrong;
  const mins = ((initialTime - currentTime) / 60) || 0.001;
  const grossWPM = Math.round((input.value.length / 5) / mins);
  wpmDisplay.innerText = grossWPM;
  
  const totalErr = wrong + half;
  errRateDisplay.innerText = (totalErr / mins).toFixed(1);
  accDisplay.innerText = Math.round((correctChars / input.value.length) * 100) + "%";
  netDisplay.innerText = Math.max(0, Math.round(((input.value.length / 5) - (totalErr * 5)) / mins));

  if(document.getElementById("autoSubmitToggle").checked && finished && typedWords.length === spans.length) finishTest();
}

function finishTest() {
  clearInterval(timer);
  isRunning = false;
  input.disabled = true;
  const result = { user: document.getElementById("username").value || "Guest", net: netDisplay.innerText, acc: accDisplay.innerText, time: new Date().toLocaleString() };
  savedResults.push(result);
  localStorage.setItem("results", JSON.stringify(savedResults));
}

function openHistory() {
  const modal = document.getElementById("historyModal");
  const container = document.getElementById("historyTable");
  container.innerHTML = savedResults.length ? "<table><tr><th>User</th><th>Net</th><th>Acc</th></tr>" + 
    savedResults.map(r => `<tr><td>${r.user}</td><td>${r.net}</td><td>${r.acc}</td></tr>`).join("") + "</table>" : "No history.";
  modal.style.display = "flex";
}
function closeHistory() { document.getElementById("historyModal").style.display="none"; }
function clearHistory() { localStorage.setItem("results","[]"); savedResults.length=0; openHistory(); }
function toggleBackspace(el) { backspaceOn = el.checked; }
function toggleTheme() { document.body.classList.toggle("light"); }
</script>
</body>
</html>
